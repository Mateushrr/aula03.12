name: integracao-ecr-eb

on:
 push: 
  branches: [ main ]

env:
 WS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
@@ -16,22 +16,28 @@ env:
 STACK_NAME: "64bit Amazon Linux 2 v3.5.7 running Docker"

jobs:
 buid:
  runs-on: ubuntu-latest
  env:
   MODULE_FULLNAME: ${{ vars.PROJECT_NAME }}/${{ vars.MODULE_NAME }}
   REGISTRY_URL: ${{ secrets.AWS_ACCOUNT_ID }}.dkr.ecr.${{ vars.AWS_REGION }}.amazonaws.com
  steps:
   - uses: actions/checkout@v4
   - uses: actions/setup-node@v4
     with:
      node-version: '18'
      cache: 'npm'
   - run: docker build -t $MODULE_FULLNAME $MODULE_NAME
   - run: docker tag $MODULE_FULLNAME:$TAG $REGISTRY_URL/$MODULE_FULLNAME:$TAG
   - run:  |
       aws ecr get-login-password --region $AWS_REGION | \
       docker login --username AWS --password-stdin $REGISTRY_URL
   - run: docker push $REGISTRY_URL/$MODULE_FULLNAME:$TAG
   - uses: actions/upload-artifact@v4
